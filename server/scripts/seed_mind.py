# -*- coding: utf-8 -*-

import sys
import os

# 添加项目根目录到Python路径
script_dir = os.path.dirname(os.path.abspath(__file__))
project_root = os.path.dirname(script_dir)
if project_root not in sys.path:
    sys.path.insert(0, project_root)

import json
from app_2 import create_app
from app_2.model.base import db
from app_2.model.mind import MindKnowledge
from app_2.lib.mind_content_generator import generate_content

SEEDS = [
    {
        'title': '认识焦虑：症状、成因与自助方法',
        'tags': ['焦虑', '科普'],
        'source': '中国心理学会科普工作委员会',
        'category': '科普',
        'content': '焦虑是一种面对未知或可能的威胁时产生的警觉和担心。常见表现包括心跳加速、出汗、注意力受损与睡眠困难。成因通常由遗传易感性、环境压力与认知偏差共同作用。自助方法包括规律作息、呼吸与放松训练、分步暴露不适情境以及记录并挑战灾难化想法；若影响日常功能，建议及时寻求专业评估与支持。',
        'read_count': 128
    },
    {
        'title': '抑郁情绪的识别与求助指南',
        'tags': ['抑郁', '求助'],
        'source': 'WHO 心理健康指南',
        'category': '指南',
        'content': '抑郁是一种以持续低落心情、兴趣或快感丧失、能量下降为核心的状态，常伴随睡眠与食欲改变、负性自评与注意力受损。若这些症状持续两周以上并影响学习或工作，应重视并寻求评估。初步自助可包括活动安排（行为激活）、规律作息与社会支持；严重时可考虑专业心理治疗或药物治疗，并联系当地心理卫生资源或危机干预热线。',
        'read_count': 96
    },
    {
        'title': '睡眠卫生：提高睡眠质量的10个建议',
        'tags': ['睡眠', '行为建议'],
        'source': 'NIMH 睡眠建议',
        'category': '建议',
        'content': '改善睡眠的关键在于睡眠卫生：保持固定的就寝与起床时间，睡前一小时减少屏幕与强刺激活动，限制咖啡因与酒精摄入，创造安静黑暗的睡眠环境。白天适度运动与避免长时间午睡也有帮助。若长期失眠影响日常功能，可尝试睡眠限制疗法与认知行为治疗（CBT-I），必要时寻求专业睡眠医学评估。',
        'read_count': 210
    },
    {
        'title': '认知重建：识别与修正消极自动化思维',
        'tags': ['认知行为疗法', '技巧'],
        'source': 'CBT 实践手册',
        'category': '技巧',
        'content': '认知重建旨在识别自动出现的负面想法（如灾难化、过度概括）并通过证据检验与替代性解释来修正。实践步骤包括记录触发事件、自动思维和证据；提出更平衡的替代想法并在日常中练习。长期练习可减少情绪困扰并提升行为适应性。',
        'read_count': 88
    },
    {
        'title': '压力管理：ABCDE 技术与呼吸放松',
        'tags': ['压力', '放松'],
        'source': '心理咨询基础',
        'category': '训练',
        'content': 'ABCDE 即识别触发事件（A）、辨认信念（B）、理解后果（C）、对信念进行辩论（D）并观察效果（E）。配合腹式呼吸或渐进性肌肉放松练习，可在紧张时刻快速调节生理激活。建议将这些技术作为常规工具，在压力情境中有意识地练习并记录效果。',
        'read_count': 77
    },
    {
        'title': '人际界限：学会说“否”的三步法',
        'tags': ['人际', '自我保护'],
        'source': '人际沟通技巧',
        'category': '技巧',
        'content': '学会设置界限可保护心理资源。三步法为：首先陈述事实（描述具体情境），其次表达感受或需求，最后明确提出可接受的请求或替代方案。练习时保持语气平和、言辞具体，有助于既维护关系又保护自我界限。',
        'read_count': 65
    },
    # 追加：权威与常见主题（14 条），可幂等插入
    {
        'title': '正念冥想：5 分钟呼吸练习',
        'tags': ['正念', '放松'],
        'source': 'MBSR 练习',
        'category': '训练',
        'content': '找一个安静的坐姿，闭或半闭眼，关注呼吸的进出。每当注意力分散时，不评判地将其温和带回呼吸上。此练习每日 5 分钟即可开始，长期坚持能提升当下感与情绪稳定。',
        'read_count': 52
    },
    {
        'title': '运动与心理健康：每周 150 分钟',
        'tags': ['运动', '生活方式'],
        'source': 'WHO 建议',
        'category': '建议',
        'content': '中等强度的有氧运动（如快走、慢跑、骑行）每周累计约 150 分钟，有助于提升情绪、改善睡眠与减轻焦虑抑郁症状。运动通过释放内啡肽与改善睡眠质量来支持心理健康，建议结合力量训练与有氧运动并逐步增加强度。',
        'read_count': 73
    },
    {
        'title': '社交焦虑自助：暴露与安全行为识别',
        'tags': ['焦虑', '暴露疗法'],
        'source': 'CBT 技术',
        'category': '技巧',
        'content': '识别那些用于避免不适的安全行为（如过度准备、回避目光接触），并列出从易到难的社交情境进行分级暴露练习。记录每次暴露前后的情绪与实际结果，逐步减少依赖安全行为可显著降低社交焦虑。',
        'read_count': 68
    },
    {
        'title': '惊恐发作应对卡片',
        'tags': ['惊恐', '呼吸'],
        'source': '临床建议',
        'category': '指南',
        'content': '当感到惊恐发作时，提醒自己这些感觉虽然强烈但通常是短暂且非致命的生理反应。采用缓慢深呼吸（例如 4-4-6 节奏）、双脚踏地并描述可见事物的地面化技巧，有助于降低生理激活并等待峰值过去。若发作频繁影响生活，应寻求专业评估。',
        'read_count': 81
    },
    {
        'title': '复原力：意义-联结-掌控三柱模型',
        'tags': ['复原力', '积极心理'],
        'source': '心理学会科普',
        'category': '科普',
        'content': '复原力可通过三个方面培养：明确个人意义与目标以维持动机，建立并维持社会支持网络以获取帮助，增强日常可控性与问题解决能力以提升掌控感。练习感恩、设定可行小目标并寻求支持都是有效方法。',
        'read_count': 44
    },
    {
        'title': '情绪日记：ABC 记录表模板',
        'tags': ['记录', '认知行为'],
        'source': 'CBT 工具',
        'category': '工具',
        'content': '情绪日记可按 ABCDE 模式记录：A 描述触发事件，B 写下自动化思维，C 记录情绪与强度，D 用证据反驳非理性想法，E 观察替代信念带来的情绪变化。定期回顾有助于识别思维模式并进行认知重建。',
        'read_count': 59
    },
    {
        'title': '失眠的刺激控制法',
        'tags': ['睡眠', '失眠'],
        'source': '睡眠医学建议',
        'category': '指南',
    'content': '刺激控制法强调把床仅用于睡眠与性行为，避免在床上看书或使用电子设备。若躺床 20 分钟仍未入睡，应起床做安静活动，困倦后再回床；逐步建立床-睡眠的条件反射，有助于提升睡眠效率。',
        'read_count': 97
    },
    {
        'title': '青少年情绪波动与求助途径',
        'tags': ['青少年', '家庭'],
        'source': '儿少心理科普',
        'category': '科普',
    'content': '青春期情绪波动较为常见，但若情绪问题持续并影响学习、人际或睡眠，应主动与家长、老师或校医沟通。鼓励开放对话、建立规律生活与必要时寻求青少年心理专业评估或家庭支持。',
        'read_count': 58
    },
    {
        'title': '悲伤与哀悼：正常过程与照料',
        'tags': ['哀伤', '适应'],
        'source': '临床心理建议',
        'category': '科普',
    'content': '哀悼是对失去的正常反应，可能经历否认、愤怒、讨价还价、沮丧与逐步接受等阶段，但过程并非线性。允许自己感受悲伤、维持基本日常并在需要时寻求支持或辅导，有助于逐步适应丧失。',
        'read_count': 42
    },
    {
        'title': '自杀风险识别五个信号与干预热线',
        'tags': ['危机', '预防'],
        'source': '公共卫生科普',
        'category': '指南',
    'content': '自杀风险的警示信号包括反复谈及死亡或绝望感、明显行为改变、准备遗物或告别行为、功能显著下降。若出现这些信号，应立即联系当地危机干预热线、医疗急救或寻求专业帮助，确保安全并获取紧急支持。',
        'read_count': 120
    },
    {
        'title': '物质成瘾：渴求管理与复发预防',
        'tags': ['成瘾', '复发预防'],
        'source': '临床指南',
        'category': '技巧',
    'content': '物质成瘾的复发预防依赖识别高风险情境、制定替代应对策略（如延迟、转移注意力）并建立支持系统。制定危机预案、定期评估诱因并参与互助或专业治疗可显著降低复发率。',
        'read_count': 55
    },
    {
        'title': '注意力训练：番茄工作法与环境优化',
        'tags': ['注意力', '执行功能'],
        'source': '时间管理方法',
        'category': '工具',
    'content': '番茄工作法以 25 分钟专注加 5 分钟短休为基础，能提高专注力并减少疲劳。优化环境以降低干扰、把任务分解为小步骤并外化待办事项，有助于提升执行效率与注意力持续性。',
        'read_count': 64
    },
    {
        'title': '家庭沟通：非暴力沟通四要素',
        'tags': ['人际', '家庭'],
        'source': 'NVC',
        'category': '技巧',
    'content': '非暴力沟通包括观察事实、表达感受、说明需要并提出具体请求。使用“我”信息而非指责性语言，能降低防御并促进建设性的对话，适用于家庭与亲密关系中的冲突解决。',
        'read_count': 70
    },
    {
        'title': '情绪调节：RULER 模型入门',
        'tags': ['情绪调节', 'SEL'],
        'source': 'SEL 框架',
        'category': '科普',
    'content': 'RULER 模型强调识别 (Recognize)、理解 (Understand)、标记 (Label)、表达 (Express) 与调节 (Regulate) 情绪。可结合情绪温度计练习，帮助人们更精准地识别情绪并选择适当的调节策略。',
        'read_count': 39
    },
    {
        'title': '职场压力：需求-控制-支持模型',
        'tags': ['职场', '压力'],
        'source': '职场心理',
        'category': '科普',
    'content': '需求-控制-支持模型指出，高需求与低控制会增加职业压力；提升自主性（控制）与获取同事或组织支持能缓冲压力影响。建议与上级沟通任务与期望、分解工作并寻求同伴支持。',
        'read_count': 63
    },
    {
        'title': '完美主义：识别标准与设定可行目标',
        'tags': ['完美主义', '目标设定'],
        'source': 'CBT 技术',
        'category': '技巧',
    'content': '完美主义常将可达到的高标准与不现实的僵化标准混淆。通过设定 SMART（具体、可测量、可达成、相关、限时）目标、允许小幅度失败并逐步暴露于“不完美”的情境，可以降低焦虑并提升功能性达成感。',
        'read_count': 66
    },
    # 进一步扩充各分类/标签（10 条）
    {
        'title': '焦虑的身体信号与认知解读',
        'tags': ['焦虑', '科普'],
        'source': '心理科普',
        'category': '科普',
    'content': '焦虑的身体信号（心跳加速、出汗、肌肉紧张）多源于交感神经激活，是身体准备应对威胁的自然反应。辨识这些信号并用呼吸、放松与认知重评来管理，有助于减少误读生理信号导致的恐慌。',
        'read_count': 41
    },
    {
        'title': '抑郁自评与就医指南（PHQ-9）',
        'tags': ['抑郁', '筛查'],
        'source': '公共卫生',
        'category': '指南',
    'content': 'PHQ-9 是一种自评量表用于初步筛查抑郁症状，但不能替代专业诊断。若量表得分较高或症状影响日常功能，应及时联系心理健康专业人员进行全面评估与干预。',
        'read_count': 88
    },
    {
        'title': '睡前仪式感：放松清单模板',
        'tags': ['睡眠', '工具'],
        'source': '睡眠卫生',
        'category': '工具',
    'content': '建立睡前仪式可帮助信号化大脑准备入睡：温水泡脚、轻度拉伸、深呼吸练习与降低光线和屏幕使用。固定上床时间并保持舒适的卧室环境，有助于形成稳定的生理节律。',
        'read_count': 72
    },
    {
        'title': '压力缓冲：社会支持地图',
        'tags': ['压力', '社交'],
        'source': '积极心理',
        'category': '工具',
    'content': '绘制社会支持地图，列出在不同情境下可求助的具体人选（家人、朋友、同事、专业资源）與联系方式。明确如何请求帮助并在需要时主动联系，有助于在压力情境中快速获取支持。',
        'read_count': 47
    },
    {
        'title': '人际冲突的“暂停-复述-共情-协商”',
        'tags': ['人际', '沟通'],
        'source': '沟通技巧',
        'category': '技巧',
    'content': '处理人际冲突时，可先暂停避免情绪化反应，复述对方要点以确认理解，表达共情后再进入解决方案协商。提出多个可选方案并寻找共同点，能提高达成一致的概率。',
        'read_count': 58
    },
    {
        'title': '正念步行：关注足部触地感',
        'tags': ['正念', '训练'],
        'source': 'MBSR',
        'category': '训练',
    'content': '正念步行关注脚掌触地与抬起的感觉，体验身体的接触与移动。将注意力带回当下，不做评判，有助于把正念练习融入日常活动并增强身体觉察。',
        'read_count': 53
    },
    {
        'title': '青少年亲子冲突的界限设定',
        'tags': ['青少年', '家庭'],
        'source': '家庭治疗',
        'category': '指南',
    'content': '处理青少年亲子冲突时，通过明确家庭规则与合理后果、保持正向关注并一致执行，有助于建立边界。鼓励表达情绪與协商解决方案，同时在必要时寻求家庭咨询支持。',
        'read_count': 46
    },
    {
        'title': '工作倦怠：情绪耗竭-去人格化-低成就感',
        'tags': ['职场', '倦怠'],
        'source': '职业健康',
        'category': '科普',
    'content': '工作倦怠包含情绪耗竭、去人格化与低成就感三维。识别早期信号、与上级沟通工作负荷、实施任务分解與恢复性安排（休假、心理支持），并考虑职业咨询或组织层面的干预。',
        'read_count': 61
    },
    {
        'title': '创伤触发识别与地面化技巧',
        'tags': ['创伤', '地面化'],
        'source': '创伤治疗',
        'category': '技巧',
    'content': '创伤触发出现时，可使用地面化技巧如 5-4-3-2-1 感官锚定（识别 5 个可见物、4 个可触物等），或手持冰块、双脚踏地来降低生理激活。若创伤反应严重或长期存在，应寻求创伤专科治疗。',
        'read_count': 75
    },
    {
        'title': '饮食与情绪：规律进食与血糖稳定',
        'tags': ['饮食', '生活方式'],
        'source': '营养与心理',
        'category': '建议',
    'content': '稳定的饮食与规律进食有助于维持血糖稳定與情绪平衡。避免长时间空腹与高糖暴食循环，优先选择富含蛋白质、复合碳水化合物與膳食纤维的食物，并注意与情绪的关系。',
        'read_count': 50
    },
    # 再补 12 条，覆盖标签：创伤/亲密关系/孕产/考试/社交/时间管理/睡眠/成瘾/复原力/自我关怀/悲伤/注意力
    {
        'title': '考试焦虑：模拟暴露与放松结合',
        'tags': ['焦虑', '考试'],
        'source': '学生心理指南',
        'category': '技巧',
    'content': '考试焦虑可通过模拟考试暴露结合放松技巧（如深呼吸、渐进肌肉放松）来减轻。制定复习计划、分块训练并练习考试策略能提升自信，必要时寻求学校心理支持。',
        'read_count': 67
    },
    {
        'title': '社交自我表露的层级法',
        'tags': ['社交', '人际'],
        'source': '人际技巧',
        'category': '技巧',
    'content': '逐步自我表露时可从低风险话题（兴趣、日常）开始，观察对方反应并逐步过渡到更私密的情绪或价值观层面。尊重界限并以互惠为原则，有助于建立亲密但安全的关系。',
        'read_count': 49
    },
    {
        'title': '亲密关系的情绪验证',
        'tags': ['亲密关系', '沟通'],
        'source': '关系修复',
        'category': '技巧',
    'content': '在亲密关系中进行情绪验证时，先用简短语言命名对方情绪并表达理解，随后再根据双方需求进入问题解决。避免在未被理解前给出建议或否定感受，这能促进连接与信任。',
        'read_count': 62
    },
    {
        'title': '产后情绪波动与求助清单',
        'tags': ['孕产', '抑郁'],
        'source': '妇幼健康',
        'category': '指南',
    'content': '产后情绪波动常见，但若低落、焦虑或功能受损持续两周以上，需警惕产后抑郁。建议尽早与产科或心理健康专业沟通，建立支持系统并考虑心理或药物干预。',
        'read_count': 71
    },
    {
        'title': '时间管理：四象限与能量曲线',
        'tags': ['时间管理', '执行功能'],
        'source': '效率工具',
        'category': '工具',
    'content': '四象限法将任务按重要/紧急分类，优先处理重要且紧急事项并为重要非紧急事项安排时间。结合个人能量曲线在高效时段安排深度工作，有助于效率與精力管理。',
        'read_count': 54
    },
    {
        'title': '睡眠限制疗法：逐步延长床上时间',
        'tags': ['睡眠', '失眠'],
        'source': '睡眠医学',
        'category': '指南',
    'content': '睡眠限制疗法由减少床上时间开始以提高睡眠效率，随着睡眠质量改善逐步延长睡眠时长。需在专业指导下实施，并结合睡眠卫生以确保安全与有效性。',
        'read_count': 83
    },
    {
        'title': '复原力练习：感恩三件事',
        'tags': ['复原力', '积极心理'],
        'source': '积极心理',
        'category': '训练',
    'content': '感恩练习每天记录三件积极小事，可训练注意力捕捉正面事件并逐步改善情绪与心理韧性。短期内坚持执行即可看到情绪基调的积极变化。',
        'read_count': 45
    },
    {
        'title': '自我关怀清单：身心需要的 ABC',
        'tags': ['自我关怀', '情绪调节'],
        'source': '心理自助',
        'category': '工具',
    'content': '自我关怀包括三个层面：身体关照（充足睡眠、营养与运动），情绪关照（允许并表达情绪、寻求安抚），以及认知关照（温和的自我对话与重评）。日常小行动如短暂休息与边界设定即为有效自我关怀实践。',
        'read_count': 52
    },
    {
        'title': '悲伤周年反应：提前准备与纪念仪式',
        'tags': ['哀伤', '适应'],
        'source': '临床建议',
        'category': '指南',
    'content': '周年反应指在失去重要事件纪念日时情绪加重，常通过安排纪念活动、与支持者在场或降低工作负荷来应对。提前准备并告诉身边人你的需求可以减少意外的情绪冲击。',
        'read_count': 38
    },
    {
        'title': '注意力分散的环境改造',
        'tags': ['注意力', '环境'],
        'source': '执行功能',
        'category': '建议',
    'content': '为减少注意力分散，可移除手机通知、清理工作环境、使用耳机或白噪音，并用番茄钟分段工作。优化环境并将任务外化能显著提高注意力与产出。',
        'read_count': 57
    },
    {
        'title': '成瘾恢复：诱发因素日记',
        'tags': ['成瘾', '复发预防'],
        'source': '临床指南',
        'category': '工具',
    'content': '成瘾恢复中使用诱发因素日记，记录“人物-地点-情绪-想法-行为”五维信息，帮助识别复发链条并提前规划替代行为或应对策略。与支持人员共享计划并定期评估能提升执行力。',
        'read_count': 60
    },
    {
        'title': '创伤后梦魇的影像排练法',
        'tags': ['创伤', '睡眠'],
        'source': '治疗技术',
        'category': '技巧',
    'content': '影像排练法是一种针对噩梦的干预：在安全环境中有意识地重写梦境结局并反复心理排练，逐步降低噩梦的频率与强度。此方法通常需在专业指导下实施以保证安全与效果。',
        'read_count': 69
    }
]


def main():
    app = create_app()
    with app.app_context():
        inserted = 0
        updated = 0
        for s in SEEDS:
                # 用生成器批量扩写正文，确保每条都达到详尽长度（开发用）
                try:
                    s['content'] = generate_content(s.get('title'), s.get('tags', []), s.get('source'))
                except Exception:
                    # 若生成器出错，则保留原有 content 字段
                    pass

                exist = MindKnowledge.get_one(title=s['title'])
                if exist:
                    # 如果已存在，则更新字段（覆盖旧内容），以便强制同步新正文
                    update_fields = {
                        'content': s['content'],
                        'tags': json.dumps(s.get('tags', []), ensure_ascii=False),
                        'source': s.get('source'),
                        'category': s.get('category'),
                        'read_count': s.get('read_count', 0)
                    }
                    exist.update(**update_fields)
                    updated += 1
                else:
                    MindKnowledge.create(
                        title=s['title'],
                        content=s['content'],
                        tags=json.dumps(s.get('tags', []), ensure_ascii=False),
                        source=s.get('source'),
                        category=s.get('category'),
                        read_count=s.get('read_count', 0)
                    )
                    inserted += 1
        db.session.commit()
        print(f"mind_knowledge seeded. inserted={inserted}, updated={updated}, total={inserted + updated}")


if __name__ == '__main__':
    main()
