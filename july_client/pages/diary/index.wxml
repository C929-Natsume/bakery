<!--pages/diary/index.wxml-->
<view class="diary-page">
  <!-- æ—¥å†å¤´éƒ¨ -->
  <view class="calendar-header">
    <view class="month-selector">
      <l-icon name="left" size="40" color="#337559" bindtap="onPrevMonth" />
      <text class="month-text">{{currentYear}}å¹´{{currentMonth}}æœˆ</text>
      <l-icon name="right" size="40" color="#337559" bindtap="onNextMonth" />
    </view>
  </view>

  <!-- æ˜ŸæœŸæ ‡é¢˜ -->
  <view class="week-header">
    <text class="week-day">æ—¥</text>
    <text class="week-day">ä¸€</text>
    <text class="week-day">äºŒ</text>
    <text class="week-day">ä¸‰</text>
    <text class="week-day">å››</text>
    <text class="week-day">äº”</text>
    <text class="week-day">å…­</text>
  </view>

  <!-- æ—¥å†ä¸»ä½“ -->
  <view class="calendar-body">
    <view class="calendar-week" wx:for="{{calendar}}" wx:key="index">
      <view 
        class="calendar-day {{dayItem ? (dayItem.isToday ? 'today' : '') : 'empty'}}"
        wx:for="{{item}}" 
        wx:for-item="dayItem"
        wx:key="day"
        data-date="{{dayItem ? dayItem.date : ''}}"
        bindtap="onDateTap"
      >
        <view wx:if="{{dayItem}}" class="day-content">
          <text class="day-number">{{dayItem.day}}</text>
          <view wx:if="{{dayItem.hasDiary}}" class="day-indicator" style="background-color: {{dayItem.emotion ? dayItem.emotion.color : '#337559'}};">
            <text class="day-emoji">{{dayItem.emotion ? dayItem.emotion.icon : 'ğŸ“'}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- ä»Šæ—¥æ—¥è®°é¢„è§ˆ -->
  <view class="today-diary">
    <view class="section-title">
      <text>ä»Šæ—¥è®¢å•</text>
      <text class="date-text">{{currentMonth}}æœˆ{{currentDay}}æ—¥</text>
    </view>
    
    <view wx:if="{{todayDiary}}" class="diary-preview" bindtap="onViewTodayDiary">
      <view class="diary-emotion">
        <text class="emotion-icon">{{todayDiary.emotion_label.icon}}</text>
        <text class="emotion-name" style="color: {{todayDiary.emotion_label.color}};">{{todayDiary.emotion_label.name}}</text>
      </view>
      <text class="diary-content">{{todayDiary.content}}</text>
      <view class="diary-meta">
        <text class="diary-time">{{todayDiary.create_time}}</text>
        <text class="diary-privacy">{{todayDiary.is_public ? 'å…¬å¼€' : 'ğŸ”’ ç§å¯†'}}</text>
      </view>
    </view>

    <view wx:else class="no-diary" bindtap="onCreateTodayDiary">
      <l-icon name="add" size="80" color="#ccc" />
      <text class="no-diary-text">å†™ä¸‹ä»Šå¤©çš„å¿ƒæƒ…</text>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading">
    <l-icon name="loading" size="60" color="#337559" />
  </view>
</view>
