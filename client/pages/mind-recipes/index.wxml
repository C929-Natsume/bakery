<!-- 心灵配方 - 列表页 -->
<view class="container">
  <!-- 顶部搜索与功能 -->
  <view class="topbar">
    <input class="search" placeholder="搜索关键词" confirm-type="search" value="{{keyword}}" bindinput="onInput" bindconfirm="onSearch" />
    <button class="btn-stars" size="mini" bindtap="gotoStars">我的收藏</button>
  </view>

  <!-- DEBUG: show counts to help diagnose missing categories/tags -->
  <view class="debug-info" style="padding:6px 12px;color:#666;font-size:12px;">
    Debug: categories length = {{categories.length}}, tags length = {{tags.length}}
  </view>

  <!-- 分类筛选 -->
  <!-- 分类筛选（始终显示第一行） -->
  <scroll-view class="chips" scroll-x="true" enable-flex>
    <view class="chip {{!category ? 'active' : ''}}" data-value="" bindtap="selectCategory">全部</view>
    <block wx:for="{{categories}}" wx:key="*this">
      <view class="chip {{category===item ? 'active' : ''}}" data-value="{{item}}" bindtap="selectCategory">{{item}}</view>
    </block>
  </scroll-view>

  <!-- 标签筛选（始终显示第二行） -->
  <scroll-view class="chips" scroll-x="true" enable-flex>
    <view class="chip {{!tag ? 'active' : ''}}" data-value="" bindtap="selectTag">全部</view>
    <block wx:for="{{tags}}" wx:key="*this">
      <view class="chip {{tag===item ? 'active' : ''}}" data-value="{{item}}" bindtap="selectTag">#{{item}}</view>
    </block>
  </scroll-view>

  <block wx:for="{{items}}" wx:key="id">
    <view class="card" bindtap="gotoDetail" data-id="{{item.id}}">
      <view class="title">{{item.title}}</view>
      <view class="meta">
  <text class="tag" wx:for="{{item.tags}}" wx:for-item="t" wx:key="*this">#{{t}}</text>
        <text class="source">{{item.source}}</text>
        <text class="read">阅读 {{item.read_count || 0}}</text>
      </view>
    </view>
  </block>

  <l-loadmore l-class="loading" show="{{loading}}" type="loading" loading-text="正在加载中..." line />
  <l-loadmore l-class="loading" show="{{!hasMore && items.length > 0}}" type="end" end-text="已经到底了" line />
  
  <!-- 显式加载更多按钮（除下拉/触底外的补充） -->
  <view wx:if="{{hasMore && !loading}}" class="more-wrap">
    <button class="btn-more" bindtap="getMore">加载更多</button>
  </view>
  <nothing wx:if="{{items.length === 0}}" pic="../../images/icon_nothing/pic_topic.png" tip="暂无心灵配方" />
</view>