<!--components/topic-item/index.wxml-->

<!-- ËØùÈ¢òÂçïÈ°π -->
<view class="topic-item-class topic-item" wx:if="{{topic && topic.user}}">
  <!-- ËØùÈ¢òÂ§¥ÈÉ® -->
  <view class="header">
    <view class="header-left">
      <!-- Â§¥ÂÉè -->
      <avatar 
        src="{{topic.user.avatar || ''}}" 
        user-id="{{topic.user.id || ''}}" 
        size="80" 
      />
      <view class="header-info">
        <view class="info-top">
          <!-- ÊòµÁß∞ -->
          <nickname 
            nickname="{{topic.user.nickname || ''}}" 
            user-id="{{topic.user.id || ''}}" 
          />
          <!-- ÁÆ°ÁêÜÂëòÊ†áÁ≠æ -->
          <l-tag 
            wx:if="{{topic.user.is_admin}}" 
            l-class="admin-tag" 
            size="mini" 
            type="reading"
          >
            ÁÆ°ÁêÜÂëò
          </l-tag>
          <!-- ÊÉÖÁª™Ê†áÁ≠æ -->
          <view wx:if="{{topic.emotion_label}}" class="emotion-tag" >
            <text class="emotion-icon">{{topic.emotion_label.icon || 'üòä'}}</text>
            <!-- <text class="emotion-name" style="color: {{topic.emotion_label.color}};">
              {{topic.emotion_label.name}}
            </text> -->
          </view>
        </view>
        <!-- Êó∂Èó¥ÂíåIPÂΩíÂ±ûÂú∞ -->
        <text class="time">
          {{topic.push_time || ''}} {{topic.ip_belong || ''}}
        </text>
      </view>
    </view>
    <!-- Êõ¥Â§öÊìç‰ΩúÂõæÊ†á -->
    <l-icon 
      l-class="icon-more" 
      name="ellipsis" 
      bindtap="onMoreIconTap" 
    />
  </view>

  <!-- ËØùÈ¢òÂÜÖÂÆπ -->
  <view class="topic-content" bindtap="gotoTopicDetail">
    <view 
      class="{{!showDetail && topic.content && topic.content.length > maxContentLen && !expand ? 'content-text-expand' : 'content-text'}}"
    >
      {{topic.content || ''}}
    </view>
    <!-- Â±ïÂºÄ/Êî∂Ëµ∑ÊåâÈíÆ -->
    <text 
      wx:if="{{!showDetail && topic.content && topic.content.length > maxContentLen}}" 
      class="text-expand" 
      catchtap="onExpandTap"
    >
      {{!expand ? 'Â±ïÂºÄ' : 'Êî∂Ëµ∑'}}
    </text>
  </view>

  <!-- ÂõæÁâáËßÜÈ¢ëÂå∫Âüü -->
  <view 
    class="media" 
    wx:if="{{(topic.images && topic.images.length > 0) || topic.video}}" 
    bindtap="gotoTopicDetail"
  >
    <!-- ÂõæÁâáÂ±ïÁ§∫ -->
    <view class="posters" wx:if="{{topic.images && topic.images.length > 0}}">
      <!-- ÂçïÂº†ÂõæÁâá -->
      <block wx:if="{{topic.images.length === 1}}">
        <image 
          class="image column-one" 
          wx:for="{{topic.images}}" 
          wx:key="index" 
          src="{{item}}" 
          mode="widthFix" 
          data-src="{{item}}" 
          catchtap="previewImage" 
        />
      </block>
      <!-- 2Âº†Êàñ4Âº†ÂõæÁâá -->
      <block wx:elif="{{topic.images.length === 2 || topic.images.length === 4}}">
        <image 
          class="image column-two" 
          wx:for="{{topic.images}}" 
          wx:key="index" 
          src="{{item}}" 
          mode="aspectFill" 
          data-src="{{item}}" 
          catchtap="previewImage" 
        />
      </block>
      <!-- ÂÖ∂‰ªñÊï∞ÈáèÂõæÁâá -->
      <block wx:else>
        <image 
          class="image" 
          wx:for="{{topic.images}}" 
          wx:key="index" 
          src="{{item}}" 
          mode="aspectFill" 
          data-src="{{item}}" 
          catchtap="previewImage" 
        />
      </block>
    </view>

    <!-- ËßÜÈ¢ëÂ±ïÁ§∫ -->
    <video 
      wx:if="{{topic.video}}" 
      class="video" 
      src="{{topic.video.src}}" 
      poster="{{topic.video.cover}}" 
      direction="0" 
      play-btn-position="center" 
      style="max-height: 580rpx;{{topic.video.height > topic.video.width ? 'height: 580rpx; width: ' + 580 * topic.video.width / topic.video.height + 'rpx' : 'width: 580rpx; height: ' + 580 * topic.video.height / topic.video.width + 'rpx;'}}" 
      autoplay="{{autoplay}}" 
      muted="{{muted}}" 
      bindplay="onVideoEvent"
      bindpause="onVideoEvent"
      bindended="onVideoEvent"
      binderror="onVideoEvent"
      catchtap="doNothing" 
    />
  </view>

  <!-- ËØùÈ¢òÊ†áÁ≠æ -->
  <view class="tags-list" wx:if="{{showTags && labels && labels.length > 0}}">
    <l-tag 
      wx:for="{{labels}}" 
      wx:key="index" 
      l-class="tag" 
      plain 
      shape="circle" 
      bg-color="#337559" 
      font-color="#337559" 
      data-label-id="{{item.id}}" 
      bindtap="onTagTap"
    >
      #{{item.name}}
    </l-tag>
  </view>

  <!-- ËØùÈ¢òÂ∫ïÈÉ®‰∫§‰∫íÊ†è -->
  <favor-bar 
    topic-id="{{topic.id}}"
    comment-count="{{topic.comment_count || 0}}" 
    view-count="{{topic.click_count || 0}}" 
    has-comment="{{topic.commented || false}}" 
    bind:commentIconTap="onCommentIconTap"
    bind:viewIconTap="onViewIconTap"
    bind:interactionChange="onInteractionChange"
  />
</view>